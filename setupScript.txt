Match (n)
DETACH DELETE n;

LOAD CSV WITH HEADERS FROM
'https://raw.githubusercontent.com/Pattern-Projects/neo4j_data/main/products.csv'
AS line
CREATE (p:Product {productNumber: toInteger(line.productNumber), brand: line.brand, deviceType: line.deviceType, version: line.version});

LOAD CSV WITH HEADERS FROM
'https://raw.githubusercontent.com/Pattern-Projects/neo4j_data/main/users.csv'
AS line
CREATE (u:User {userNumber: toInteger(line.userNumber), firstName: line.firstName, lastName: line.lastName, address: line.address, email: line.email});

LOAD CSV WITH HEADERS FROM
'https://raw.githubusercontent.com/Pattern-Projects/neo4j_data/main/devices.csv'
AS line
CREATE (d:Device {serialNumber: toInteger(line.serialNumber), name: line.Name, location: line.location, active: toBoolean(line.active), batteryPercentage: line.batteryPercentage, productNumber: toInteger(line.productNumber), userNumber: toBoolean(line.registeredTo)})
WITH d
MATCH (p:Product)
WHERE p.productNumber = d.productNumber
MERGE (d)-[:OFMAKE]->(p)
WITH d
MATCH (u:User)
WHERE u.userNumber = d.registeredTo
MERGE (d) - [:REGISTEREDTO] -> (u);

